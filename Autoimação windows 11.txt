if( [System.Environment]::OSVersion.Version.Build -lt 26100 ) {
    'This script requires Windows 11 24H2 or later.' | Write-Warning;
    return;
}

$timeout = [datetime]::Now.AddMinutes(5);
$exe = "$env:LOCALAPPDATA\Microsoft\WindowsApps\winget.exe";

while ($true) {
    if ($exe | Test-Path) {
        # Lista de programas para instalar
        $apps = @(
            "RARLab.WinRAR",
            "clsid2.mpc-hc",
            "UnifiedIntents.UnifiedRemote",
            "Tonec.InternetDownloadManager"
        )

        foreach ($app in $apps) {
            Write-Host "Instalando: $app"
            & $exe install --exact --id $app --silent --accept-package-agreements --accept-source-agreements --source winget --scope machine;
        }

        Write-Host "Todos os programas foram instalados!"
        return;
    }

    if ([datetime]::Now -gt $timeout) {
        'File {0} does not exist.' -f $exe | Write-Warning;
        return;
    }

    Start-Sleep -Seconds 1;
}
